"use strict";(self.webpackChunkgallery_frontend=self.webpackChunkgallery_frontend||[]).push([[642],{3241:function(e,n,t){t.d(n,{Z:function(){return l}});var a=t(4810),i=t(9293),r="ImageMenu_imageMenuWrapper__RbDLE",s="ImageMenu_imageMenuButton__dlwkj",o=t(184),l=function(e){var n=e.className,t=e.isOpened,l=void 0===t||t,c=e.groupMenuMode,u=void 0!==c&&c,d=e.modalImageMode,g=void 0!==d&&d,m=e.onDelete,f=e.onEdit,p=e.onShare,_=e.onSelect,x=i.Z.imagesStoreSettings,h=x.toggleSelectAllImages,v=x.selectedImages,y=l?0:-1;return(0,o.jsxs)("div",{className:"".concat(r," ").concat(n),children:[!g&&(0,o.jsx)(a.zx,{className:s,type:"button",title:"Select mode on/off",icon:"icon_select",onClick:_,tabIndex:y}),u&&(0,o.jsx)(a.zx,{className:s,type:"button",title:"Select / deselect all",icon:"icon_select_all",onClick:h,tabIndex:y}),!u&&(0,o.jsx)(a.zx,{className:s,type:"button",title:"Edit tags",icon:"icon_edit",onClick:f,tabIndex:y}),(0,o.jsx)(a.zx,{className:s,type:"button",title:"Share",icon:"icon_share",disabled:u&&!v.length,onClick:p,tabIndex:y}),(0,o.jsx)(a.zx,{className:s,type:"button",title:"Delete",icon:"icon_delete",disabled:u&&!v.length,onClick:m,tabIndex:y})]})}},2574:function(e,n,t){t.d(n,{Z:function(){return d}});var a=t(3032),i=t(3430),r=t(4322),s=t.n(r),o=t(2791),l=t(9293),c=t(4810),u=t(184),d=function(e){var n=e._id,t=e.onCloseDeleteOverlay,r=e.onConfirmDeleteOverlay,d=(0,o.useState)(!1),g=(0,i.Z)(d,2),m=g[0],f=g[1],p=l.Z.imagesStoreSettings,_=p.deleteImages,x=p.selectedListChange,h=p.clearSelectedList,v=function(){var e=(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),x(n),e.next=4,_();case 4:h(),r&&r();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,u.jsxs)("div",{className:"imageCardOverlay",children:[(0,u.jsx)("p",{className:"imageCardOverlay-title",children:"Sure you want to delete this item?"}),(0,u.jsxs)("div",{className:"imageCardOverlay-buttonWrapper",children:[(0,u.jsx)(c.zx,{type:"button",text:"Delete",onClick:v}),(0,u.jsx)(c.zx,{type:"button",text:"Cancel",onClick:function(){t()}})]}),m&&(0,u.jsx)(c.$j,{side:20})]})}},1539:function(e,n,t){t.d(n,{Z:function(){return I}});var a=t(5531),i=t(3032),r=t(3430),s=t(4322),o=t.n(s),l=t(2791),c=t(9293),u=t(5412),d=t(4810);var g=function(e,n){return e.slice(0,n-3).concat("...")},m=t(6272),f="ShareOverlay_shareOverlay__cGOYJ",p="ShareOverlay_option__DLqqN",_="ShareOverlay_shareOverlayTitle__qEKRZ",x="ShareOverlay_shareOverlayCheckbox__edKCU",h="ShareOverlay_openedTo__jvKcx",v="ShareOverlay_addUserBtn__0WUda",y="ShareOverlay_sharedByLinkBtn__Uh9D9",j="ShareOverlay_standaloneShareLinkWrapper__eNGzX",S="ShareOverlay_standaloneShareLink__gN0eY",C="ShareOverlay_linkRemoveBtn__eeM4h",k="ShareOverlay_buttonWrapper__38mEy",b=t(184),I=function(e){var n=e._id,t=e.isPublic,s=e.openedTo,I=e.sharedByLink,N=e.onCloseShareOverlay,Z=e.setIsLoading,O=c.Z.backendUrl,M=c.Z.imagesStoreSettings,L=M.editImagesInfo,T=M.imagesMultiuserShare,w=c.Z.userSettings,E=w.userName,z=w.checkIfUserExistsByName,D=s.map((function(e){return{name:e,action:"none"}})),B=(0,l.useState)(t),W=(0,r.Z)(B,2),P=W[0],G=W[1],H=(0,l.useState)(I),U=(0,r.Z)(H,2),A=U[0],R=U[1],q=(0,l.useState)(D),F=(0,r.Z)(q,2),K=F[0],V=F[1],$=(0,l.useState)(!1),Y=(0,r.Z)($,2),J=Y[0],X=Y[1],Q=function(){var e=(0,i.Z)(o().mark((function e(n){var t,i,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(n);case 2:if(t=e.sent,n!==E&&t){e.next=5;break}return e.abrupt("return");case 5:-1!==(i=K.findIndex((function(e){return e.name===n})))?((r=(0,a.Z)(K))[i].action="add",V(r)):V([].concat((0,a.Z)(K),[{name:n,action:"add"}]));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ee=function(){var e=(0,i.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z(!0),t=ne(),e.next=4,L([{_id:n,imageInfo:{isPublic:P,openedTo:t,sharedByLink:A}}]);case 4:return e.next=6,T([n],K);case 6:N(),Z(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){return K.filter((function(e){return"remove"!==e.action})).map((function(e){return e.name}))};return J?(0,b.jsx)(u.Z,{tags:ne(),closeHandle:function(){X(!1)},onTagDelete:function(e){var n=K.map((function(n){return n.name===e?{name:n.name,action:"remove"}:n}));V(n)},onAddTags:Q}):(0,b.jsx)("div",{className:"imageCardOverlay",children:(0,b.jsxs)("div",{className:"".concat(f),children:[(0,b.jsx)("p",{className:"imageCardOverlay-title ".concat(_),children:"Image share options"}),(0,b.jsx)("div",{className:p,children:(0,b.jsxs)("label",{children:["Make the image public.",(0,b.jsx)(d.XZ,{isChecked:P,onChange:function(){G(!P)},className:x})]})}),(0,b.jsxs)("div",{className:p,children:[(0,b.jsx)("p",{className:h,children:"Is opened to users : "}),K.map((function(e){return"remove"===e.action?null:(0,b.jsx)(d.Vp,{tagValue:e.name},e.name)})),(0,b.jsx)(d.zx,{className:v,text:"Edit",title:"Edit list of users with acces to this image",icon:"icon_edit",onClick:function(){X(!0)}})]}),(0,b.jsx)("div",{className:p,children:A?(0,b.jsxs)("div",{className:j,onClick:function(){navigator.clipboard.writeText(O+"/public/standaloneShare/"+n),(0,m.O)("Sharing link copied to clipboard.")},children:["Sharing link:"," ",(0,b.jsx)("span",{className:S,children:g(O+"/public/standaloneShare/"+n,50)}),(0,b.jsx)(d.zx,{className:"".concat(C," closeBtn"),iconSize:10,icon:"icon_close",onClick:function(e){e.stopPropagation(),R(!1),(0,m.O)("Sharing link removed. Click accept to deactivate it.")}})]}):(0,b.jsx)(d.zx,{type:"button",className:y,text:"Generate sharing link",onClick:function(){R(!0),(0,m.O)("Sharing link created. Click accept to activate it.")}})}),(0,b.jsxs)("div",{className:k,children:[(0,b.jsx)(d.zx,{type:"button",text:"Accept",onClick:ee}),(0,b.jsx)(d.zx,{type:"button",text:"Cancel",onClick:N})]})]})})}},5412:function(e,n,t){t.d(n,{Z:function(){return g}});var a=t(3430),i=t(2791),r=t(5832),s=t(4810),o="TagEditor_tagEditor__RGvqH",l="TagEditor_tagEditorInputFormBtn__aLVM9",c="TagEditor_tagInputForm__zZLJ9",u="TagEditor_newTagInput__NgRZ6",d=t(184),g=function(e){var n=e.tags,t=e.closeHandle,g=e.onTagDelete,m=e.onAddTags,f=(0,i.useState)(""),p=(0,a.Z)(f,2),_=p[0],x=p[1];return(0,d.jsxs)("div",{className:"imageCardOverlay ".concat(o),children:[(0,d.jsxs)("div",{className:c,children:[(0,d.jsx)(s.zx,{type:"button",title:"Close tag editor",className:"closeBtn",icon:"icon_close",onClick:t}),(0,d.jsx)("input",{value:_,type:"text",maxLength:30,className:u,onChange:function(e){x(e.target.value)},onKeyPress:function(e){"Enter"===e.code&&(m(_),x(""))}}),(0,d.jsx)(s.zx,{type:"button",className:l,title:"Add tag",icon:"icon_plus",onClick:function(){_&&m(_),x("")}})]}),(0,d.jsx)(r.Z,{tags:n,isEditable:!0,tagDelHandler:g})]})}},5832:function(e,n,t){t.d(n,{Z:function(){return l}});var a=t(4810),i=t(32),r="TagList_tagList__rPF1Z",s="TagList_listPlaceholder__4BTLS",o=t(184),l=(0,i.Pi)((function(e){var n=e.tags,t=e.title,i=e.placeholder,l=e.isEditable,c=e.onDoubleClick,u=e.tagDelHandler;return(0,o.jsx)("ul",{title:n.length?t:"",className:r,onDoubleClick:l&&c?c:function(){return null},children:n.length?n.map((function(e,n){return(0,o.jsx)(a.Vp,{tagValue:e,isDeletable:u&&l,deleteTag:l&&u?u:function(){return null}},n)})):(0,o.jsx)("li",{className:s,children:i})})}))},8642:function(e,n,t){t.r(n),t.d(n,{default:function(){return W}});var a=t(3430),i=t(2791),r=t(32),s=t(3032),o=t(5531),l=t(4322),c=t.n(l),u=t(5832),d=t(4810),g=t(5412),m=t(3241),f=t(2574),p=t(1539),_="SelectOverlay_selectOverlay__MoiQq",x="SelectOverlay_checked__zmzsv",h="SelectOverlay_selectCheckbox__U7NyR",v=t(184),y=function(e){var n=e.isSelected,t=void 0!==n&&n,a=e.onSelectToggle,i=function(e){e.stopPropagation(),e.preventDefault(),a()};return(0,v.jsx)("div",{className:t?_+" "+x:_,onClick:i,onKeyPress:i,tabIndex:0,children:(0,v.jsx)(d.XZ,{title:"check / uncheck",isChecked:t,onChange:i,className:t?h+" "+x:h})})},j=t(9293),S={cardWrap:"ImageCard_cardWrap__k-g5e",cardBackdrop:"ImageCard_cardBackdrop__BQgAI",text:"ImageCard_text__jKCqu",menu:"ImageCard_menu__OJ0JT",imageMenuWrapper:"ImageCard_imageMenuWrapper__IsYHV",isOpened:"ImageCard_isOpened__0W4SK",imgWrap:"ImageCard_imgWrap__DZXhA",menuButton:"ImageCard_menuButton__VhhIp",imgInfo:"ImageCard_imgInfo__E2biY",tagList:"ImageCard_tagList__FKG5s",imgTag:"ImageCard_imgTag__gfZ+5",addInfo:"ImageCard_addInfo__ZH4sU",imgOverlay:"ImageCard_imgOverlay__PRMEl",imageCardSpinner:"ImageCard_imageCardSpinner__hYqTO"},C=(0,i.memo)((0,r.Pi)((function(e){var n=e.image,t=e.isSelected,r=e.groupSelectMode;console.log("Image render");var l=j.Z.imagesStoreSettings,_=l.getCurrentGalleryMode,x=l.editImagesInfo,h=l.groupSelectModeToggle,C=l.selectedListChange,k=j.Z.userSettings,b=k.userName,I=k.userIsAuthenticated,N=j.Z.modalWindowsSettings,Z=N.setModalOpen,O=N.setModalComponentType,M=N.setModalImageId,L=n._id,T=n.smallImageURL,w=n.imageInfo,E=n.toggleSelectImage,z=w.tags,D=w.likes,B=w.openedTo,W=w.sharedByLink,P=w.isPublic,G=(0,i.useState)(!1),H=(0,a.Z)(G,2),U=H[0],A=H[1],R=(0,i.useState)(!1),q=(0,a.Z)(R,2),F=q[0],K=q[1],V=(0,i.useState)(!1),$=(0,a.Z)(V,2),Y=$[0],J=$[1],X=(0,i.useState)(!1),Q=(0,a.Z)(X,2),ee=Q[0],ne=Q[1],te=(0,i.useState)(!0),ae=(0,a.Z)(te,2),ie=ae[0],re=ae[1],se=(0,i.useState)(!1),oe=(0,a.Z)(se,2),le=oe[0],ce=oe[1],ue=(0,i.useRef)(null);(0,i.useEffect)((function(){r||E(!1),console.log("groupSelectMode effect")}),[r,E]),(0,i.useEffect)((function(){ue.current&&Y&&(ue.current.tabIndex=0,ue.current.focus()),console.log("Image menu effect")}),[Y]);var de="userGallery"===_,ge=(0,i.useCallback)((function(){J(!1),h()}),[h]),me=(0,i.useCallback)((function(){ce(!0),J(!1)}),[]),fe=(0,i.useCallback)((function(){A(!0),J(!1)}),[]),pe=(0,i.useCallback)((function(){K(!0),J(!1)}),[]),_e=function(){var e=(0,s.Z)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ne(!0),e.next=3,x([{_id:L,imageInfo:{tags:n}}]);case 3:ne(!1);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),xe=function(){var e=(0,s.Z)(c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("toggleLikeHandler fires"),ne(!0),n=[],n=D.includes(b)?D.filter((function(e){return e!==b})):[].concat((0,o.Z)(D),[b]),e.next=6,x([{_id:L,imageInfo:{likes:n}}]);case 6:ne(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(){return!le&&!U&&!F&&!r};return(0,v.jsxs)("div",{className:S.cardWrap,tabIndex:r?-1:0,onMouseLeave:function(e){e.stopPropagation(),J(!1)},children:[ee?(0,v.jsx)(d.$j,{side:30,className:S.imageCardSpinner}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:S.cardBackdrop,style:{backgroundImage:"url(".concat(T,")"),visibility:ie?"hidden":"visible"}}),(0,v.jsxs)("div",{tabIndex:-1,className:S.imgWrap,onClick:function(){M(L),O("image"),Z(!0)},children:[ie&&(0,v.jsx)(d.$j,{side:50}),(0,v.jsx)("img",{className:S.image,src:T,alt:L,onLoad:function(){re(!1)},style:{visibility:ie?"hidden":"visible"}})]}),he()&&!r&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:S.menu,children:[(0,v.jsx)(d.zx,{type:"button",icon:"icon_like",onClick:xe,className:S.menuButton,text:D.length,disabled:!I,title:"Like / Dislike"}),de&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{ref:ue,className:Y?S.imageMenuWrapper+" "+S.isOpened:S.imageMenuWrapper,children:(0,v.jsx)(m.Z,{isOpened:Y,onDelete:fe,onEdit:me,onSelect:ge,onShare:pe})}),(0,v.jsx)("div",{style:{position:"relative"},children:(0,v.jsx)(d.zx,{type:"button",title:"Image menu",icon:"icon_settings",onClick:function(e){e.stopPropagation(),J(!Y)},className:S.menuButton})})]})]}),(0,v.jsx)("div",{className:S.text,children:(0,v.jsx)("div",{className:S.imgCardText,children:(0,v.jsx)(u.Z,{tags:z,title:de?"Double click to edit":"No tags",placeholder:de?"Double click to add tags":"No tags",isEditable:!0,onDoubleClick:de?me:function(){return null}})})})]})]}),!he()&&(0,v.jsxs)("div",{className:S.imgOverlay,children:[" ",le&&(0,v.jsx)(g.Z,{tags:z,closeHandle:function(){return ce(!1)},onTagDelete:function(e){var n=z.filter((function(n){return n!==e}));_e(n)},onAddTags:function(e){var n=e.split(/,/).map((function(e){return e.trim()}));_e([].concat((0,o.Z)(z),(0,o.Z)(n)))}}),U&&(0,v.jsx)(f.Z,{_id:L,onCloseDeleteOverlay:function(){return A(!1)}}),F&&(0,v.jsx)(p.Z,{_id:L,isPublic:P,openedTo:B,sharedByLink:W,onCloseShareOverlay:function(){return K(!1)},setIsLoading:ne}),r&&(0,v.jsx)(y,{isSelected:t,onSelectToggle:function(){E(!t),C(L)}}),ee&&(0,v.jsx)(d.$j,{side:30,className:S.imageCardSpinner})]})]})}))),k=t(4164),b="Modal_modalBackdrop__6HAsx",I="Modal_isOpened__1g212",N=(0,i.lazy)((function(){return t.e(997).then(t.bind(t,3997))})),Z=(0,i.lazy)((function(){return t.e(958).then(t.bind(t,6958))})),O=(0,i.lazy)((function(){return t.e(513).then(t.bind(t,7513))})),M=(0,i.lazy)((function(){return t.e(728).then(t.bind(t,728))})),L=(0,i.lazy)((function(){return t.e(662).then(t.bind(t,5662))})),T=document.querySelector("#modal-root"),w=(0,r.Pi)((function(){var e=j.Z.modalWindowsSettings,n=e.modalComponentType,t=e.modalIsOpened,r=e.setModalOpen,s=e.setModalComponentType,o=(0,i.useState)(!1),l=(0,a.Z)(o,2),c=l[0],u=l[1],g=(0,i.useCallback)((function(e){e.target!==e.currentTarget&&"Escape"!==e.key||m()}),[r,s]),m=function(){r(!1),s("none")};return(0,i.useEffect)((function(){return t&&!c&&window.addEventListener("keydown",g),function(){window.removeEventListener("keydown",g)}}),[t,g,c]),(0,k.createPortal)((0,v.jsx)("div",{className:t?b+" "+I:b,onClick:g,children:(0,v.jsxs)(i.Suspense,{fallback:(0,v.jsx)(d.$j,{side:50}),children:[" ",function(){switch(n){case"image":return(0,v.jsx)(M,{});case"delete":return(0,v.jsx)(Z,{isLoading:c,setIsLoading:u,modalCloseHandle:m});case"share":return(0,v.jsx)(O,{isLoading:c,setIsLoading:u,modalCloseHandle:m});case"upload":return(0,v.jsx)(N,{isLoading:c,setIsLoading:u,modalCloseHandle:m});case"menu":return(0,v.jsx)(L,{modalCloseHandle:m});default:return null}}()]})}),T)})),E="Gallery_sectionGallery__cUG3t",z="Gallery_groupSelectMode__IWNlk",D="Gallery_galleryPage__4rWwl",B="Gallery_groupImageMenuWrapper__l3Nwn";var W=(0,r.Pi)((function(e){var n=e.label,t=(0,i.useState)([]),r=(0,a.Z)(t,2),s=r[0],o=r[1],l=j.Z.imagesStoreSettings,c=l.setGalleryMode,u=l.imageStoreInit,g=l.getUserImages,f=l.groupSelectMode,p=l.groupSelectModeToggle,_=l.clearSelectedList,x=l.isLoading,h=j.Z.modalWindowsSettings,y=h.setModalComponentType,S=h.setModalOpen;(0,i.useEffect)((function(){u(n).then((function(){return o(g)}))}),[u,c,g,n]);var k=(0,i.useCallback)((function(){_(),p()}),[_,p]),b=(0,i.useCallback)((function(){y("delete"),S(!0)}),[y,S]),I=(0,i.useCallback)((function(){y("share"),S(!0)}),[y,S]);return x?(0,v.jsx)(d.$j,{side:100}):(0,v.jsxs)("section",{className:f?E+" "+z:E,children:[s.length?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:f?B+" "+z:B,children:(0,v.jsx)(m.Z,{isOpened:f,groupMenuMode:!0,onSelect:k,onDelete:b,onShare:I})}),(0,v.jsx)("div",{className:D,children:s.map((function(e){return console.log("render cards"),(0,v.jsx)(C,{image:e,isSelected:e.isSelected,groupSelectMode:f},e._id)}))})]}):(0,v.jsx)(d.$j,{side:100}),(0,v.jsx)(w,{})]})}))},3032:function(e,n,t){function a(e,n,t,a,i,r,s){try{var o=e[r](s),l=o.value}catch(c){return void t(c)}o.done?n(l):Promise.resolve(l).then(a,i)}function i(e){return function(){var n=this,t=arguments;return new Promise((function(i,r){var s=e.apply(n,t);function o(e){a(s,i,r,o,l,"next",e)}function l(e){a(s,i,r,o,l,"throw",e)}o(void 0)}))}}t.d(n,{Z:function(){return i}})}}]);
//# sourceMappingURL=642.af924853.chunk.js.map