{"version":3,"file":"static/js/728.513399ef.chunk.js","mappings":"0SACA,EAA6B,+BAA7B,EAAwE,8BAAxE,EAAqH,iCAArH,EAAyK,qCAAzK,EAAkO,sCAAlO,EAA4R,sCAA5R,EAAmV,mCAAnV,EAAuY,mCAAvY,EAAwb,gC,SC8Pxb,EApPmB,WACjB,MACEA,EAAAA,EAAAA,oBADMC,EAAR,EAAQA,eAAgBC,EAAxB,EAAwBA,eAAgBC,EAAxC,EAAwCA,sBAExC,EACEH,EAAAA,EAAAA,qBADMI,EAAR,EAAQA,aAAcC,EAAtB,EAAsBA,gBAAiBC,EAAvC,EAAuCA,aAAcC,EAArD,EAAqDA,sBAErD,EAA0CP,EAAAA,EAAAA,aAAlCQ,EAAR,EAAQA,oBAAqBC,EAA7B,EAA6BA,SAE7B,GAAkDC,EAAAA,EAAAA,YAAlD,eAAOC,EAAP,KAA0BC,EAA1B,KACA,GAAgDF,EAAAA,EAAAA,WAAS,GAAzD,eAAOG,EAAP,KAAyBC,EAAzB,KACA,GAA4CJ,EAAAA,EAAAA,WAAS,GAArD,eAAOK,EAAP,KAAuBC,EAAvB,KACA,GAA8CN,EAAAA,EAAAA,WAAS,GAAvD,eAAOO,EAAP,KAAwBC,EAAxB,KACA,GAAoDR,EAAAA,EAAAA,WAAS,GAA7D,eAAOS,EAAP,KAA2BC,EAA3B,KACA,IAAsDV,EAAAA,EAAAA,WAAS,GAA/D,iBAAOW,GAAP,MAA4BC,GAA5B,MAEMC,IAAiBC,EAAAA,EAAAA,cACrB,kBACEvB,EAAeG,GAAcqB,MAAK,SAACC,GACjCd,EAAqBc,QAEzB,KAGFC,EAAAA,EAAAA,YAAU,WACRJ,OACC,CAACnB,EAAcH,EAAgBsB,KAElC,IAIMK,GAAiB,mCAAG,+FAChBC,EAAQlB,EAARkB,IACAC,EAAUnB,EAAmBoB,UAA7BD,MAERhB,GAAoB,GAChBkB,EAAe,GAIjBA,EAHGF,EAAMG,SAASxB,GAGHqB,EAAMI,QAAO,SAACC,GAAD,OAAUA,IAAS1B,KAFnC,kBAAOqB,GAAP,CAAcrB,IAPJ,SAWlBP,EAAe,CAAC,CAAE2B,IAAAA,EAAKE,UAAW,CAAED,MAAOE,MAXzB,OAYxBT,KACAT,GAAoB,GAbI,2CAAH,qDAgDjBsB,GAAiB,mCAAG,WAAOC,GAAP,8EAChBR,EAAQlB,EAARkB,IACRf,GAAoB,GAFI,SAGlBZ,EAAe,CAAC,CAAE2B,IAAAA,EAAKE,UAAW,CAAEO,KAAMD,MAHxB,OAIxBd,KACAT,GAAoB,GALI,2CAAH,sDAajByB,GAAuC,gBAA1BpC,EAEnB,OAAOQ,GACL,iBAAK6B,UAAWC,EAAhB,WACE,iBAAKD,UAAWC,EAAhB,UACG1B,IAAkB,SAAC,KAAD,CAAS2B,KAAM,MAClC,gBACEC,IAAG,OAAEhC,QAAF,IAAEA,OAAF,EAAEA,EAAmBiC,SACxBC,IAAK,sBACLC,OA1EY,WAClB9B,GAAkB,IA0EZ+B,MAAO,CAAEC,WAAajC,EAA6B,SAAZ,iBAG3C,iBAAKyB,UAAWC,EAAhB,WACE,iCACE,iBAAKD,UAAWC,EAAhB,WACE,iBAAKD,UAAWC,EAAhB,WACE,SAAC,KAAD,CACEQ,KAAK,SACLC,KAAK,YACLC,QAASvB,GACTY,UAAWC,EACXW,KAAMzC,EAAkBoB,UAAUD,MAAMuB,OACxCC,UAAW9C,EACX+C,MAAM,oBAER,yCACA,SAAC,KAAD,CACEN,KAAK,SACLM,MAAM,mBACNf,UAAU,WACVU,KAAK,aACLM,SAAU,GACVL,QAtCgB,WAC5B7C,GAAa,GACbC,EAAsB,cAwCbC,GAAuB+B,KACtB,SAACkB,EAAA,EAAD,CACEjB,UAAWC,EACXiB,gBAAgB,EAChBC,QAnFkB,WAC9BvC,GAAsB,IAmFVwC,SAjFmB,WAC/BtC,IAAuB,UAqFjB,iBAAKkB,UAAWC,EAAhB,WACE,gBAAKD,UAAWC,EAAhB,SACG9B,EAAkBoB,UAAUO,KAAKe,OAAS,IACzC,SAACQ,EAAA,EAAD,CACEvB,KAAM3B,EAAkBoB,UAAUO,KAClCwB,WAAYvB,GACZwB,cAlGW,WACzB7C,GAAmB,SAqGX,0yBAeA,0yBAeA,0yBAeA,+yBAiBHL,IAAoB,SAAC,KAAD,CAAS6B,KAAM,QAGrCvB,IACC,SAAC6C,EAAA,EAAD,CACEnC,IAAKlB,EAAkBkB,IACvBoC,SAAUtD,EAAkBoB,UAAUkC,SACtCC,SAAUvD,EAAkBoB,UAAUmC,SACtCC,aAAcxD,EAAkBoB,UAAUoC,aAC1CC,aAActD,EACduD,oBApKyB,WAC/B9C,KACAH,GAAsB,MAqKnBC,KACC,SAACiD,EAAA,EAAD,CACEzC,IAAKlB,EAAkBkB,IACvB0C,qBArK0B,kBAAMjD,IAAuB,IAsKvDkD,uBArK4B,WAClCnE,EAAgB,IAChBE,EAAsB,QACtBD,GAAa,MAqKVW,IACC,SAACwD,EAAA,EAAD,CACEnC,KAAM3B,EAAkBoB,UAAUO,KAClCoC,UA/Jc,SAACC,GACrB,IAAMC,EAAaD,EAAUE,MAAM,KAAKC,KAAI,SAACC,GAAD,OAASA,EAAIC,UACzD5C,GAAkB,GAAD,eAAKzB,EAAmBoB,UAAUO,OAAlC,OAA2CsC,MA8JtDK,YAtKc,SAACC,GACrB,IAAM7C,EAAU1B,EAAmBoB,UAAUO,KAAKJ,QAChD,SAAC6C,GAAD,OAASA,IAAQG,KAEnB9C,GAAkBC,IAmKZ8C,YA/KsB,kBAAMjE,GAAmB,UAoLrD,SAAC,KAAD,CAASwB,KAAM","sources":["webpack://gallery-frontend/./src/components/Modals/ModalImage/ModalImage.module.scss?87ca","components/Modals/ModalImage/ModalImage.tsx"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"modalImage\":\"ModalImage_modalImage__0CAfI\",\"imagePart\":\"ModalImage_imagePart__JnNhA\",\"nonImagePart\":\"ModalImage_nonImagePart__u9pP+\",\"modalImageHeader\":\"ModalImage_modalImageHeader__ggnak\",\"imageTitleWrapper\":\"ModalImage_imageTitleWrapper__d2Lkj\",\"modalImageLikeBtn\":\"ModalImage_modalImageLikeBtn__ghxPD\",\"modalImageMenu\":\"ModalImage_modalImageMenu__pMd0+\",\"tagListWrapper\":\"ModalImage_tagListWrapper__4Q-Kw\",\"description\":\"ModalImage_description__36ntf\"};","import { useState, useEffect, useCallback } from \"react\";\r\nimport { Spinner, Button } from \"components/elements\";\r\nimport TagList from \"components/TagList\";\r\nimport ImageMenu from \"components/ImageMenu\";\r\nimport ShareOverlay from \"components/Overlays/ShareOverlay\";\r\nimport DeleteOverlay from \"components/Overlays/DeleteOverlay\";\r\nimport TagEditor from \"../../TagEditor\";\r\nimport store from \"../../../MST/store\";\r\nimport { ImageType } from \"MST/imagesStoreSettings\";\r\nimport styles from \"./ModalImage.module.scss\";\r\n\r\nconst ModalImage = () => {\r\n  const { fetchImageById, editImagesInfo, getCurrentGalleryMode } =\r\n    store.imagesStoreSettings;\r\n  const { modalImageId, setModalImageId, setModalOpen, setModalComponentType } =\r\n    store.modalWindowsSettings;\r\n  const { userIsAuthenticated, userName } = store.userSettings;\r\n\r\n  const [currentModalImage, setCurrentModalImage] = useState<ImageType>();\r\n  const [imgInfoIsLoading, setimgInfoIsLoading] = useState(false);\r\n  const [imageIsLoading, setImageIsLoading] = useState(true);\r\n  const [tagEditorIsOpen, setTagEditorIsOpen] = useState(false);\r\n  const [shareOverlayIsOpen, setShareOverlayIsOpen] = useState(false);\r\n  const [deleteOverlayIsOpen, setDeleteOverlayIsOpen] = useState(false);\r\n\r\n  const loadModalImage = useCallback(\r\n    () =>\r\n      fetchImageById(modalImageId).then((image) => {\r\n        setCurrentModalImage(image);\r\n      }),\r\n    []\r\n  );\r\n\r\n  useEffect(() => {\r\n    loadModalImage();\r\n  }, [modalImageId, fetchImageById, loadModalImage]);\r\n\r\n  const onImageLoad = () => {\r\n    setImageIsLoading(false);\r\n  };\r\n\r\n  const toggleLikeHandler = async () => {\r\n    const { _id } = currentModalImage!;\r\n    const { likes } = currentModalImage!.imageInfo;\r\n\r\n    setimgInfoIsLoading(true);\r\n    let newLikesList = [];\r\n    if (!likes.includes(userName)) {\r\n      newLikesList = [...likes, userName];\r\n    } else {\r\n      newLikesList = likes.filter((name) => name !== userName);\r\n    }\r\n    await editImagesInfo([{ _id, imageInfo: { likes: newLikesList } }]);\r\n    loadModalImage();\r\n    setimgInfoIsLoading(false);\r\n  };\r\n\r\n  const tagEditOpenHandler = () => {\r\n    setTagEditorIsOpen(true);\r\n  };\r\n  const shareOverlayOpenHandler = () => {\r\n    setShareOverlayIsOpen(true);\r\n  };\r\n  const deleteOverlayOpenHandler = () => {\r\n    setDeleteOverlayIsOpen(true);\r\n  };\r\n\r\n  const shareOverlayCloseHandler = () => {\r\n    loadModalImage();\r\n    setShareOverlayIsOpen(false);\r\n  };\r\n  const onTagEditCloseHandler = () => setTagEditorIsOpen(false);\r\n  const deleteOverlayCloseHandler = () => setDeleteOverlayIsOpen(false);\r\n  const deleteOverlayConfirmHandler = () => {\r\n    setModalImageId(\"\");\r\n    setModalComponentType(\"none\");\r\n    setModalOpen(false);\r\n  };\r\n\r\n  const tagDelHandler = (tagToDelete: string) => {\r\n    const newTags = currentModalImage!.imageInfo.tags.filter(\r\n      (tag) => tag !== tagToDelete\r\n    );\r\n    tagsUpdateHandler(newTags);\r\n  };\r\n  const tagAddHandler = (tagsToAdd: string) => {\r\n    const parsedTags = tagsToAdd.split(/,/).map((tag) => tag.trim());\r\n    tagsUpdateHandler([...currentModalImage!.imageInfo.tags, ...parsedTags]);\r\n  };\r\n  const tagsUpdateHandler = async (newTags: string[]) => {\r\n    const { _id } = currentModalImage!;\r\n    setimgInfoIsLoading(true);\r\n    await editImagesInfo([{ _id, imageInfo: { tags: newTags } }]);\r\n    loadModalImage();\r\n    setimgInfoIsLoading(false);\r\n  };\r\n\r\n  const modalImageCloseHandle = () => {\r\n    setModalOpen(false);\r\n    setModalComponentType(\"none\");\r\n  };\r\n\r\n  const isUserMode = getCurrentGalleryMode === \"userGallery\";\r\n\r\n  return currentModalImage ? (\r\n    <div className={styles.modalImage}>\r\n      <div className={styles.imagePart}>\r\n        {imageIsLoading && <Spinner side={50} />}\r\n        <img\r\n          src={currentModalImage?.imageURL}\r\n          alt={\"God save the queen!\"}\r\n          onLoad={onImageLoad}\r\n          style={{ visibility: !imageIsLoading ? \"visible\" : \"hidden\" }}\r\n        />\r\n      </div>\r\n      <div className={styles.nonImagePart}>\r\n        <>\r\n          <div className={styles.modalImageHeader}>\r\n            <div className={styles.imageTitleWrapper}>\r\n              <Button\r\n                type=\"button\"\r\n                icon=\"icon_like\"\r\n                onClick={toggleLikeHandler}\r\n                className={styles.modalImageLikeBtn}\r\n                text={currentModalImage.imageInfo.likes.length}\r\n                disabled={!userIsAuthenticated}\r\n                title=\"Like / Dislike\"\r\n              />\r\n              <h2>Image title</h2>\r\n              <Button\r\n                type=\"button\"\r\n                title=\"Close tag editor\"\r\n                className=\"closeBtn\"\r\n                icon=\"icon_close\"\r\n                iconSize={30}\r\n                onClick={modalImageCloseHandle}\r\n              />\r\n            </div>\r\n\r\n            {userIsAuthenticated && isUserMode && (\r\n              <ImageMenu\r\n                className={styles.modalImageMenu}\r\n                modalImageMode={true}\r\n                onShare={shareOverlayOpenHandler}\r\n                onDelete={deleteOverlayOpenHandler}\r\n              />\r\n            )}\r\n          </div>\r\n\r\n          <div className={styles.description}>\r\n            <div className={styles.tagListWrapper}>\r\n              {currentModalImage.imageInfo.tags.length > 0 && (\r\n                <TagList\r\n                  tags={currentModalImage.imageInfo.tags}\r\n                  isEditable={isUserMode}\r\n                  onDoubleClick={tagEditOpenHandler}\r\n                />\r\n              )}\r\n            </div>\r\n            <p>\r\n              Description of the image. Lorem ipsum dolor sit amet consectetur\r\n              adipisicing elit. Rerum accusamus hic distinctio nesciunt\r\n              temporibus accusantium aliquam quisquam eligendi eveniet enim\r\n              facilis nisi ad officiis qui, iusto blanditiis labore\r\n              exercitationem. Voluptatem consectetur molestiae nemo debitis\r\n              maiores ab tenetur, natus excepturi. Maiores ex hic assumenda\r\n              molestias rem minima laborum labore natus animi eum. Explicabo\r\n              ipsam temporibus molestias assumenda numquam officiis sint amet\r\n              placeat. Eos minus aliquam ratione illo dicta, distinctio a\r\n              adipisci, rerum hic ex pariatur corrupti odit sit nesciunt\r\n              accusamus! Minus sunt error sint? Est veritatis possimus nobis\r\n              placeat. Vel nostrum facilis soluta adipisci explicabo ratione\r\n              aliquam mollitia reprehenderit delectus neque.\r\n            </p>\r\n            <p>\r\n              Description of the image. Lorem ipsum dolor sit amet consectetur\r\n              adipisicing elit. Rerum accusamus hic distinctio nesciunt\r\n              temporibus accusantium aliquam quisquam eligendi eveniet enim\r\n              facilis nisi ad officiis qui, iusto blanditiis labore\r\n              exercitationem. Voluptatem consectetur molestiae nemo debitis\r\n              maiores ab tenetur, natus excepturi. Maiores ex hic assumenda\r\n              molestias rem minima laborum labore natus animi eum. Explicabo\r\n              ipsam temporibus molestias assumenda numquam officiis sint amet\r\n              placeat. Eos minus aliquam ratione illo dicta, distinctio a\r\n              adipisci, rerum hic ex pariatur corrupti odit sit nesciunt\r\n              accusamus! Minus sunt error sint? Est veritatis possimus nobis\r\n              placeat. Vel nostrum facilis soluta adipisci explicabo ratione\r\n              aliquam mollitia reprehenderit delectus neque.\r\n            </p>\r\n            <p>\r\n              Description of the image. Lorem ipsum dolor sit amet consectetur\r\n              adipisicing elit. Rerum accusamus hic distinctio nesciunt\r\n              temporibus accusantium aliquam quisquam eligendi eveniet enim\r\n              facilis nisi ad officiis qui, iusto blanditiis labore\r\n              exercitationem. Voluptatem consectetur molestiae nemo debitis\r\n              maiores ab tenetur, natus excepturi. Maiores ex hic assumenda\r\n              molestias rem minima laborum labore natus animi eum. Explicabo\r\n              ipsam temporibus molestias assumenda numquam officiis sint amet\r\n              placeat. Eos minus aliquam ratione illo dicta, distinctio a\r\n              adipisci, rerum hic ex pariatur corrupti odit sit nesciunt\r\n              accusamus! Minus sunt error sint? Est veritatis possimus nobis\r\n              placeat. Vel nostrum facilis soluta adipisci explicabo ratione\r\n              aliquam mollitia reprehenderit delectus neque.\r\n            </p>\r\n            <p>\r\n              Description of the image. Lorem ipsum dolor sit amet consectetur\r\n              adipisicing elit. Rerum accusamus hic distinctio nesciunt\r\n              temporibus accusantium aliquam quisquam eligendi eveniet enim\r\n              facilis nisi ad officiis qui, iusto blanditiis labore\r\n              exercitationem. Voluptatem consectetur molestiae nemo debitis\r\n              maiores ab tenetur, natus excepturi. Maiores ex hic assumenda\r\n              molestias rem minima laborum labore natus animi eum. Explicabo\r\n              ipsam temporibus molestias assumenda numquam officiis sint amet\r\n              placeat. Eos minus aliquam ratione illo dicta, distinctio a\r\n              adipisci, rerum hic ex pariatur corrupti odit sit nesciunt\r\n              accusamus! Minus sunt error sint? Est veritatis possimus nobis\r\n              placeat. Vel nostrum facilis soluta adipisci explicabo ratione\r\n              aliquam mollitia reprehenderit delectus neque.\r\n            </p>\r\n          </div>\r\n        </>\r\n        {imgInfoIsLoading && <Spinner side={50} />}\r\n      </div>\r\n\r\n      {shareOverlayIsOpen && (\r\n        <ShareOverlay\r\n          _id={currentModalImage._id}\r\n          isPublic={currentModalImage.imageInfo.isPublic}\r\n          openedTo={currentModalImage.imageInfo.openedTo}\r\n          sharedByLink={currentModalImage.imageInfo.sharedByLink}\r\n          setIsLoading={setimgInfoIsLoading}\r\n          onCloseShareOverlay={shareOverlayCloseHandler}\r\n        />\r\n      )}\r\n      {deleteOverlayIsOpen && (\r\n        <DeleteOverlay\r\n          _id={currentModalImage._id}\r\n          onCloseDeleteOverlay={deleteOverlayCloseHandler}\r\n          onConfirmDeleteOverlay={deleteOverlayConfirmHandler}\r\n        />\r\n      )}\r\n      {tagEditorIsOpen && (\r\n        <TagEditor\r\n          tags={currentModalImage.imageInfo.tags}\r\n          onAddTags={tagAddHandler}\r\n          onTagDelete={tagDelHandler}\r\n          closeHandle={onTagEditCloseHandler}\r\n        />\r\n      )}\r\n    </div>\r\n  ) : (\r\n    <Spinner side={50} />\r\n  );\r\n};\r\n\r\nexport default ModalImage;\r\n"],"names":["store","fetchImageById","editImagesInfo","getCurrentGalleryMode","modalImageId","setModalImageId","setModalOpen","setModalComponentType","userIsAuthenticated","userName","useState","currentModalImage","setCurrentModalImage","imgInfoIsLoading","setimgInfoIsLoading","imageIsLoading","setImageIsLoading","tagEditorIsOpen","setTagEditorIsOpen","shareOverlayIsOpen","setShareOverlayIsOpen","deleteOverlayIsOpen","setDeleteOverlayIsOpen","loadModalImage","useCallback","then","image","useEffect","toggleLikeHandler","_id","likes","imageInfo","newLikesList","includes","filter","name","tagsUpdateHandler","newTags","tags","isUserMode","className","styles","side","src","imageURL","alt","onLoad","style","visibility","type","icon","onClick","text","length","disabled","title","iconSize","ImageMenu","modalImageMode","onShare","onDelete","TagList","isEditable","onDoubleClick","ShareOverlay","isPublic","openedTo","sharedByLink","setIsLoading","onCloseShareOverlay","DeleteOverlay","onCloseDeleteOverlay","onConfirmDeleteOverlay","TagEditor","onAddTags","tagsToAdd","parsedTags","split","map","tag","trim","onTagDelete","tagToDelete","closeHandle"],"sourceRoot":""}